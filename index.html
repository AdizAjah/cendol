<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CENDOLE - 21 (Saw Edition)</title>
    <style>
        body {
            background-color: #050505;
            color: #dcdcdc;
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }
        .game-container {
            width: 800px;
            max-width: 95%;
            background-color: #111;
            border: 1px solid #333;
            padding: 20px;
            box-shadow: 0 0 30px rgba(0,0,0,0.9);
            text-align: center;
            position: relative;
        }
        /* Efek TV Lama/Scanline */
        .game-container::before {
            content: " ";
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 2;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }

        h1 { color: #cc3333; text-shadow: 0 0 5px #ff0000; margin-bottom: 25px; letter-spacing: 2px; }
        
        .info-panel {
            display: flex;
            justify-content: space-between;
            background: #1a1a1a;
            padding: 15px;
            border: 1px solid #333;
            margin-bottom: 20px;
            font-weight: bold;
            box-shadow: inset 0 0 10px #000;
        }

        .area {
            min-height: 160px;
            border: 1px dashed #333;
            margin: 10px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.02);
            position: relative;
        }

        /* --- KARTU --- */
        .card {
            display: inline-block;
            width: 60px;
            height: 90px;
            background-color: #e0e0e0;
            color: #111;
            border-radius: 4px;
            margin: 5px;
            line-height: 90px;
            font-size: 28px;
            font-weight: bold;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.7);
            position: relative;
        }
        .card.hidden {
            background-color: #800;
            color: transparent;
            background-image: repeating-linear-gradient(45deg, #600 0, #600 10px, #400 10px, #400 20px);
            border: 1px solid #300;
        }

        /* --- VISUAL GERGAJI (MODIFIKASI) --- */
        .saw-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 30px 0;
            padding: 0 20px;
            position: relative;
            z-index: 5;
        }

        .track-wrapper {
            width: 42%;
            text-align: center;
            position: relative;
        }

        .track-label {
            color: #888; 
            font-size: 12px; 
            margin-bottom: 8px; 
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .metal-track {
            height: 12px;
            background: #000;
            border-bottom: 1px solid #444;
            position: relative;
            box-shadow: inset 0 0 5px #000;
            /* Membuat tampilan rel bergerigi */
            background-image: repeating-linear-gradient(90deg, #111, #111 5px, #222 5px, #222 6px);
        }

        /* Safe Zone sekarang transparan, hanya berfungsi sebagai pengatur jarak */
        .safe-zone {
            height: 100%;
            background: transparent; /* Bar nyawa dihilangkan */
            width: 100%;
            transition: width 0.8s cubic-bezier(0.25, 1, 0.5, 1);
            position: relative;
            border-right: 2px solid rgba(255, 0, 0, 0.3); /* Sedikit indikator batas */
        }

        /* Ikon Gergaji */
        .saw-blade {
            position: absolute;
            top: -24px; /* Posisi naik sedikit agar pas di tengah rel */
            font-size: 45px;
            filter: drop-shadow(0 0 8px rgba(255, 0, 0, 0.8));
            animation: spin 0.15s linear infinite;
            z-index: 10;
        }

        /* Posisi Gergaji Player (Menempel di ujung kanan safe zone) */
        #p-saw {
            right: -22px; 
        }

        /* Posisi Gergaji Musuh (Menempel di ujung kiri safe zone karena RTL) */
        #e-saw {
            left: -22px;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* --- CONTROLS --- */
        .controls { margin-top: 25px; }
        button {
            background: #222;
            color: #ddd;
            border: 1px solid #555;
            padding: 12px 25px;
            cursor: pointer;
            font-family: inherit;
            font-size: 14px;
            margin: 0 5px;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        button:hover:not(:disabled) { 
            background: #cc3333; 
            border-color: #ff0000; 
            color: #fff;
            box-shadow: 0 0 10px #800;
        }
        button:disabled { 
            background: #0a0a0a; 
            color: #444; 
            border-color: #333;
            cursor: not-allowed; 
        }
        
        /* --- TRUMP CARDS --- */
        .trump-area {
            margin-top: 20px;
            border-top: 1px solid #333;
            padding-top: 15px;
        }
        .trump-card {
            background: #2a2205;
            border: 1px solid #665c20;
            color: #d4c355;
            padding: 8px 12px;
            margin: 4px;
            font-size: 11px;
            cursor: pointer;
            display: inline-block;
        }
        .trump-card:hover:not(:disabled) {
            background: #4a3b10;
            border-color: #ffd700;
            color: #ffd700;
        }
        
        #log {
            margin-top: 15px;
            color: #888;
            font-size: 14px;
            height: 30px;
            font-style: italic;
        }

        /* Shake Effect */
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
    </style>
</head>
<body>

<div class="game-container">
    <h1>21: SURVIVAL</h1>

    <div class="saw-container">
        <!-- Player Track -->
        <div class="track-wrapper">
            <div class="track-label">YOU</div>
            <div class="metal-track">
                <!-- Safe zone transparan, hanya mengatur posisi gergaji -->
                <div class="safe-zone" id="p-safe-zone">
                    <div class="saw-blade" id="p-saw">⚙️</div>
                </div>
            </div>
        </div>

        <div style="font-size: 20px; color: #444; font-weight:bold;">VS</div>

        <!-- Enemy Track (Direction RTL agar gergaji bergerak dari kanan ke kiri) -->
        <div class="track-wrapper">
            <div class="track-label">LUCAS</div>
            <div class="metal-track" style="direction: rtl;"> 
                <div class="safe-zone" id="e-safe-zone">
                    <div class="saw-blade" id="e-saw">⚙️</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="info-panel">
        <div>HP: <span id="player-hp">10</span></div>
        <div>BET: <span id="current-bet" style="color:#ff3333">1</span></div>
        <div>HP: <span id="enemy-hp">10</span></div>
    </div>

    <div class="area" id="enemy-area">
        <h3 style="margin-top:0; color:#888;">LUCAS</h3>
        <div id="enemy-cards"></div>
        <div id="enemy-score" style="margin-top:10px; color:#aaa;">Score: ???</div>
    </div>

    <div class="area" id="player-area">
        <h3 style="margin-top:0; color:#888;">YOU</h3>
        <div id="player-cards"></div>
        <div id="player-score" style="margin-top:10px; color:#aaa;">Score: 0</div>
    </div>

    <div id="log">Waiting to start...</div>

    <div class="controls">
        <button id="btn-hit" onclick="playerHit()">HIT</button>
        <button id="btn-stay" onclick="playerStay()">STAY</button>
        <button id="btn-next" onclick="startRound()" style="display:none;">NEXT ROUND</button>
    </div>

    <div class="trump-area">
        <p style="color:#555; font-size:12px; margin-bottom:5px;">TRUMP CARDS</p>
        <button class="trump-card" id="trump-2up" onclick="useTrump('2up')">TWO-UP (+2 Bet)</button>
        <button class="trump-card" id="trump-shield" onclick="useTrump('shield')">SHIELD (-1 Bet)</button>
        <button class="trump-card" id="trump-love" onclick="useTrump('love')">LOVE YOUR ENEMY (Force Hit)</button>
        <button class="trump-card" id="trump-destroy" style="color: #ff6666; border-color: #a33;" onclick="useTrump('destroy')">DESTROY (Reset)</button>
        <button class="trump-card" id="trump-exchange" style="color: #66ff66; border-color: #3a3;" onclick="useTrump('exchange')">EXCHANGE (Swap)</button>
    </div>
</div>

<script>
    // --- STATE ---
    let deck = [];
    let playerHand = [];
    let enemyHand = [];
    let currentBet = 1;
    let playerHP = 10;
    let enemyHP = 10;
    let gameOver = false;

    // --- LOGIC ---
    function resetDeck() {
        deck = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]; 
        shuffle(deck);
    }

    function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function drawCard() {
        if (deck.length === 0) return null;
        return deck.pop(); 
    }

    function startRound() {
        if (playerHP <= 0 || enemyHP <= 0) {
            log("Game Over. Refresh to restart.");
            return;
        }

        resetDeck();
        playerHand = [drawCard(), drawCard()];
        enemyHand = [drawCard(), drawCard()];
        currentBet = 1; 
        gameOver = false;

        // Reset Trumps
        ['trump-2up', 'trump-shield', 'trump-love', 'trump-destroy', 'trump-exchange'].forEach(id => {
            document.getElementById(id).disabled = false;
        });

        document.getElementById('btn-hit').disabled = false;
        document.getElementById('btn-stay').disabled = false;
        document.getElementById('btn-next').style.display = 'none';
        
        updateUI();
        log("Round start. Cards dealt.");
    }

    function getScore(hand) {
        return hand.reduce((a, b) => a + b, 0);
    }

    function playerHit() {
        let card = drawCard();
        if (card) {
            playerHand.push(card);
            log(`You drew ${card}.`);
            if (getScore(playerHand) > 21) {
                log("YOU BUST!");
                endRound();
            } else {
                updateUI();
            }
        }
    }

    function playerStay() {
        document.getElementById('btn-hit').disabled = true;
        document.getElementById('btn-stay').disabled = true;
        log("You Stay. Lucas's turn...");
        enemyTurn();
    }

    function enemyTurn() {
        let currentScore = getScore(enemyHand);
        let bustChance = calculateBustChance(currentScore);
        
        log(`Lucas thinking... (Risk: ${Math.round(bustChance)}%)`);

        setTimeout(() => {
            let shouldHit = false;
            let playerScore = getScore(playerHand);
            
            // Logika AI Sederhana tapi Efektif
            if (currentScore === 21) shouldHit = false;
            else if (bustChance < 30) shouldHit = true;
            else if (currentScore < playerScore && playerScore <= 21) shouldHit = true; // Desperate
            else shouldHit = false;

            if (shouldHit) {
                let card = drawCard();
                if (card) {
                    enemyHand.push(card);
                    log(`Lucas hits and gets ${card}.`);
                    updateUI(); // Update UI segera setelah ambil kartu
                    
                    if (getScore(enemyHand) > 21) {
                        endRound();
                    } else {
                        enemyTurn(); // Mikir lagi
                    }
                } else {
                    endRound();
                }
            } else {
                log("Lucas Stays.");
                endRound();
            }
        }, 1200);
    }

    function calculateBustChance(currentScore) {
        let bustCount = 0;
        let total = deck.length;
        if (total === 0) return 100;
        deck.forEach(card => {
            if (currentScore + card > 21) bustCount++;
        });
        return (bustCount / total) * 100;
    }

    function useTrump(type) {
        if (gameOver) return;
        
        if (type === '2up') currentBet += 2;
        else if (type === 'shield') currentBet = Math.max(0, currentBet - 1);
        else if (type === 'love') {
            let card = drawCard();
            if (card) enemyHand.push(card);
        }
        else if (type === 'destroy') currentBet = 1;
        else if (type === 'exchange') [playerHand, enemyHand] = [enemyHand, playerHand];

        document.getElementById('trump-' + type).disabled = true;
        updateUI();
        log(`Trump activated: ${type.toUpperCase()}`);
    }

    function endRound() {
        gameOver = true;
        document.getElementById('btn-hit').disabled = true;
        document.getElementById('btn-stay').disabled = true;
        document.getElementById('btn-next').style.display = 'inline-block';

        updateUI(); // Reveal cards

        let pScore = getScore(playerHand);
        let eScore = getScore(enemyHand);
        let winner = "draw";

        if (pScore > 21 && eScore > 21) winner = pScore < eScore ? "player" : "enemy";
        else if (pScore > 21) winner = "enemy";
        else if (eScore > 21) winner = "player";
        else if (pScore > eScore) winner = "player";
        else if (eScore > pScore) winner = "enemy";

        if (winner === "player") {
            enemyHP -= currentBet;
            log(`YOU WIN! Lucas takes ${currentBet} damage.`);
        } else if (winner === "enemy") {
            playerHP -= currentBet;
            log(`YOU LOSE! You take ${currentBet} damage.`);
            document.querySelector('.game-container').classList.add('shake');
            setTimeout(() => document.querySelector('.game-container').classList.remove('shake'), 500);
        } else {
            log("DRAW.");
        }

        updateUI(); // Update Visual HP position

        if (playerHP <= 0) setTimeout(() => alert("YOU DIED"), 500);
        if (enemyHP <= 0) setTimeout(() => alert("LUCAS DEFEATED"), 500);
    }

    function log(msg) {
        document.getElementById('log').innerText = msg;
    }

    function renderCards(elementId, cards, hideFirst = false) {
        const container = document.getElementById(elementId);
        container.innerHTML = '';
        cards.forEach((card, index) => {
            let div = document.createElement('div');
            div.className = 'card';
            if (hideFirst && index === 0) {
                div.classList.add('hidden');
                div.innerText = "?";
            } else {
                div.innerText = card;
            }
            container.appendChild(div);
        });
    }

    function updateUI() {
        document.getElementById('current-bet').innerText = currentBet;
        document.getElementById('player-hp').innerText = Math.max(0, playerHP);
        document.getElementById('enemy-hp').innerText = Math.max(0, enemyHP);

        renderCards('player-cards', playerHand);
        document.getElementById('player-score').innerText = "Score: " + getScore(playerHand);

        if (!gameOver) {
            renderCards('enemy-cards', enemyHand, true);
            let visibleScore = enemyHand.length > 1 ? getScore(enemyHand.slice(1)) : 0;
            document.getElementById('enemy-score').innerText = "Score: ? + " + visibleScore;
        } else {
            renderCards('enemy-cards', enemyHand, false);
            document.getElementById('enemy-score').innerText = "Score: " + getScore(enemyHand);
        }

        // UPDATE POSISI GERGAJI (Visual HP)
        let pPercent = Math.max(0, (playerHP / 10) * 100);
        let ePercent = Math.max(0, (enemyHP / 10) * 100);
        
        document.getElementById('p-safe-zone').style.width = pPercent + "%";
        document.getElementById('e-safe-zone').style.width = ePercent + "%";
    }

    // Start
    startRound();
</script>

</body>
</html>